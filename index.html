<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Operator DAG</title>
  <style>
    html, body, #cy {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
  </style>
  <!-- Cytoscape.js CDN -->
  <script src="https://unpkg.com/cytoscape@3/dist/cytoscape.min.js"></script>
</head>
<body>
<div id="cy"></div>

<script>
  // 加载 graph.json
  fetch('graph.json')
    .then(resp => resp.json())
    .then(data => {
      const elements = [];

      // 节点
      data.nodes.forEach(n => {
        elements.push({
          data: {
            id: n.id,
            label: n.label,
            shape: JSON.stringify(n.shape || ''),
            dtype: n.dtype || '',
            op: n.op || ''
          }
        });
      });

      // 边
      data.edges.forEach(e => {
        elements.push({
          data: {
            id: e.from + '->' + e.to,
            source: e.from,
            target: e.to
          }
        });
      });

      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: elements,
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(label)',
              'text-wrap': 'wrap',
              'text-max-width': 160,
              'font-size': 10,
              'background-color': '#8bc34a',
              'border-width': 1,
              'border-color': '#333'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 1.5,
              'curve-style': 'bezier',
              'target-arrow-shape': 'triangle',
              'target-arrow-color': '#999',
              'line-color': '#999'
            }
          }
        ],
        layout: {
          name: 'cose',  // 自动布局（力导向）
          animate: false
        }
      });

      // 点击节点时展示详细信息
      cy.on('tap', 'node', function (evt) {
        const d = evt.target.data();
        alert(
          'id: '   + d.id   + '\n' +
          'op: '   + d.op   + '\n' +
          'label: ' + d.label + '\n' +
          'shape: ' + d.shape + '\n' +
          'dtype: ' + d.dtype
        );
      });
    });
</script>
</body>
</html>
